{% extends 'base.html.twig' %}

{% block javascripts_top %}
    {{ parent() }}
    <script src="https://api-maps.yandex.ru/2.1/?apikey=3834eace-6729-4d52-9da4-ce2d5aba9c39&lang=ru_RU" type="text/javascript"></script>
    <script src="/js/yandex_maps_functions.js"></script>
{#    <script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A90577dde2499d7a9c9714365ac8fed6351a78cee74eb966c239de55db5a2ce04&amp;width=500&amp;height=400&amp;lang=ru_RU&amp;scroll=true"></script>#}
{% endblock %}

{% block content %}
    <div id="create-object-form">
        <input id="cad-number" type="text" placeholder="Кадастровый номер...">
        <input onclick="createObject()" type="button" value="Создать на карте">
        <input type="button" value="Создать файл">
    </div>

    <div id="map" style="width: 600px; height: 400px"></div>
{% endblock %}

{% block javascripts %}
    <script>
        ymaps.ready(init);

        function init() {
            var myMap = new ymaps.Map('map', {
                    center: [55.76, 37.64],
                    zoom: 10
                }, {
                    searchControlProvider: 'yandex#search'
                }),
                objectManager = new ymaps.ObjectManager({
                    // Чтобы метки начали кластеризоваться, выставляем опцию.
                    clusterize: true,
                    // ObjectManager принимает те же опции, что и кластеризатор.
                    gridSize: 32,
                    clusterDisableClickZoom: true
                });

            // Чтобы задать опции одиночным объектам и кластерам,
            // обратимся к дочерним коллекциям ObjectManager.
            objectManager.objects.options.set('preset', 'islands#greenDotIcon');
            objectManager.clusters.options.set('preset', 'islands#greenClusterIcons');
            myMap.geoObjects.add(objectManager);

            $.ajax({
                url: "../../test.geojson"
            }).done(function(data) {
                console.log(data);
                objectManager.add(data);
                console.log(objectManager.objects);
                myMap.geoObjects.add(objectManager);
            });

            $.getJSON('../../test.geojson')
                .done(function (geoJson) {
                    console.log(geoJson);
                    setYandexGeoJson(geoJson);
                    addFeature('name', 'description', ['00001', '000002']);
                    console.log(geoJson);
                    createFile();
                    console.log('created file');
                });
        }
    </script>
    <script>
        function createObject() {
            var cadNumber = $('#cad-number').val();

            console.log(cadNumber);

            $.ajax({
                method: "POST",
                url: "/bankruptcy/create-object-on-yandex-map",
                data: "cadNumber=" + cadNumber,
                success: function (response) {
                    console.log(response);
                }
            });
        }
    </script>
{% endblock %}